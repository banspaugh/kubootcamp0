<!DOCTYPE html>
<html lang="en-us">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.7.3/d3.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
        crossorigin="anonymous">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootswatch/4.0.0/darkly/bootstrap.min.css">
    <!-- <script defer src="https://use.fontawesome.com/releases/v5.0.7/js/all.js"></script> -->
    <title>Dashboard</title>
</head>

<div class="container py-2">
    <div class='card'>
        <div class='card-header'>
            <div class="mx-auto">
                <hr>
                <h2 class='text-center'>Belly Button Biodiversity Dashboard</h2>
                <hr>
            </div>
            <br>
            <h5 class='text-center'>Use the interactive charts below to explore the dataset.</h5>
        </div>
    </div>
    <div class='card'>
        <div align="center">
            <div class="form-group">
                <label for="selDataset">Select your specimen:</label>
                <br>
                <select class="col-sm-2 col-form-control" id="selDataset" onchange="optionChanged(this.value)">
                </select>
            </div>
            <div id='pie'></div>
            <div id='bubbles'></div>
        </div>
    </div>
</div>


<script>
    var someList = document.getElementById("selDataset");

    d3.json('/names', function (error, data) {

        for (var i = 0; i < data.length; i++) {
            var nameItem = document.createElement("option");
            var something = data[i];
            nameItem.innerHTML = something;
            someList.appendChild(nameItem);
        }
    });

    function optionChanged(value) {
        makeSumPie(value)
        makeSumBubs(value)
    }

    function init() {
        let current_thing = 'BB_940'
        d3.json('/samples/' + current_thing, function (error, data) {
            if (error) throw error;
            var otu_id = []
            var otu_value = []
            var response = data
            for (var i = 0; i < 10; i++) {
                otu_id.push(data[0][i]);
            }
            for (var i = 0; i < 10; i++) {
                otu_value.push(data[1][i]);
            }

            var data = [{
                values: otu_value,
                labels: otu_id,
                type: "pie"
            }];



            Plotly.plot("pie", data);

            var trace1 = {
                x: response[0],
                y: response[1],
                mode: 'markers',
                marker: {
                    size: response[1],
                    color: response[0]
                }
            };
            var data1 = [trace1];

            Plotly.newPlot('bubbles', data1);
        });
    }
    init();

    function makeSumPie(value) {
        d3.json('/samples/' + value, function (error, data) {
            if (error) throw error;
            var otu_id = []
            var otu_value = []
            for (var i = 0; i < 10; i++) {
                otu_id.push(data[0][i]);
            }
            for (var i = 0; i < 10; i++) {
                otu_value.push(data[1][i]);
            }

            var data = [{
                values: otu_value,
                labels: otu_id,
                type: "pie"
            }];
            updatePlotly(data);
        });
    }

    function makeSumBubs(value) {
        d3.json('/samples/' + value, function (error, data) {
            if (error) throw error;

            var trace1 = {
                x: data[0],
                y: data[1],
                mode: 'markers',
                marker: {
                    size: data[1],
                    color: data[0]
                }
            };
            var data1 = [trace1];
            console.log(data[0])
            console.log(data[1])
            updateBubs(data1)
        });
    }

    function updatePlotly(newData) {
        var PIE = document.getElementById("pie");
        Plotly.newPlot(PIE, newData);
    }

    function updateBubs(newData) {
        var bubs = document.getElementById("bubbles");
        Plotly.newPlot(bubs, newData);
    }
</script>